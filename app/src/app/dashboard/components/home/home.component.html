<div class="grid main">
  <p-card class="col-4">
    <ng-template pTemplate="header">
      <h2 class="pt-1 pl-2 mb-1">Upload Price</h2>
    </ng-template>
    <p-toast></p-toast>
    <p-fileUpload name="demo[]" #fileUpload [multiple]="true" (uploadHandler)="onUpload($event,fileUpload)"
      [customUpload]="true" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
      <ng-template pTemplate="content">
        <ul *ngIf="uploadedFiles.length">
          <li *ngFor="let file of uploadedFiles">{{ file.name }} - {{ file.size }} bytes</li>
        </ul>
      </ng-template>
    </p-fileUpload>
  </p-card>
  <p-card class="col-4">
    <ng-template pTemplate="header">
      <h2 class="pt-1 pl-2 mb-1">Upload Test Values</h2>
    </ng-template>
    <p-toast></p-toast>
    <p-fileUpload name="demo[]" #fileUploadForTestValues [multiple]="true"
      (uploadHandler)="onUploadTestValues($event,fileUploadForTestValues)" [customUpload]="true"
      accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
      <ng-template pTemplate="content">
        <ul *ngIf="uploadedTestValues.length">
          <li *ngFor="let file of uploadedTestValues">{{ file.name }} - {{ file.size }} bytes</li>
        </ul>
      </ng-template>
    </p-fileUpload>
  </p-card>

  <p-card class="col-4">
    <div>
      <div class="back-test">
        <h2 class="pl-2 mb-1" style="flex-grow: 2;">Back Test</h2>
        <div class="mr-1">
          <label class="switch">         
            <input type="checkbox" [(ngModel)]="isNewFormula">
            <span class="slider round"></span>
            <div>Use BP Variation</div>
          </label>
        </div>
        <p-button class="pt-1" label="Start Back Test"
          [disabled]="!testList.length && (!products.length || !stockData.length)"
          (click)="startBackTest(1)"></p-button>
      </div>
    
      <form class="backTestForm" [formGroup]="backTestForm" class=" flex gap-1 pt-5">
        <div class="form-input">
          <input type="text" pInputText appTwoDigitDecimal maxlength="5" placeholder="SLOSS %" class="p-inputtext-sm"
            formControlName="slossPercent" />
        </div>
        <div class="form-input">
          <input type="text" pInputText appTwoDigitDecimal maxlength="5" placeholder="TGT %" class="p-inputtext-sm"
            formControlName="tgPercent" />
        </div>
        <div class="form-input">
          <input type="text" pInputText appTwoDigitDecimal maxlength="5" placeholder="TSC %" class="p-inputtext-sm"
            formControlName="tsPercent" />
        </div>
      </form>
    </div>
  </p-card>
</div>

<div class="grid main">
  <div class="col-6" *ngIf="products.length">
    <p-card styleClass="mt-3">
      <ng-template pTemplate="header">
        <div class="stock-header">
          <h2 class="px-3 pt-3">Stock Table</h2>
          <!-- <i class="pi pi-download" style="font-size: 1.5rem;cursor: pointer" (click)="exceldownload(1)"></i> -->
        </div>
      </ng-template>
      <!-- [tableStyle]="{'min-width': '60rem'}" -->
      <p-table [value]="products" [paginator]="products.length > 5" [rows]="5"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [rowsPerPageOptions]="[5,10, 25, 50]">
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="date" style="width:20%">Date </th>
            <th pSortableColumn="open" style="width:20%">Open </th>
            <th pSortableColumn="high" style="width:20%">High </th>
            <th pSortableColumn="low" style="width:20%">Low </th>
            <th pSortableColumn="price" style="width:20%">Close </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-product>
          <tr>
            <td>{{product.period | date:'dd-MM-yyyy'}}</td>
            <td>{{product.open}}</td>
            <td>{{product.high}}</td>
            <td>{{product.low}}</td>
            <td>{{product.price}}</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
  <div class="col-6" *ngIf="stockData.length">
    <p-card styleClass="mt-3">
      <ng-template pTemplate="header">
        <div class="stock-header">
          <h2 class="px-3 pt-3">Stock Table</h2>
        </div>
      </ng-template>
      <p-table [value]="stockData" [paginator]="stockData.length > 5" [rows]="5"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [rowsPerPageOptions]="[5,10, 25, 50]">
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="date" style="width:20%">Date </th>
            <th pSortableColumn="name" style="width:20%">Name </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-product>
          <tr>
            <td>{{product.date | date:'dd-MM-yyyy'}}</td>
            <td>{{product.name}}</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>

  <div class="col-6" *ngIf="testList.length">
    <p-card styleClass="mt-3">
      <ng-template pTemplate="header">
        <div class="stock-header">
          <h2 class="px-3 pt-3">Test Values</h2>
          <!-- <i class="pi pi-download" style="font-size: 1.5rem;cursor: pointer" (click)="exceldownload(2)"></i> -->
        </div>
      </ng-template>
      <p-table [value]="testList" [paginator]="testList.length > 5" [rows]="5"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [rowsPerPageOptions]="[5,10, 25, 50] ">
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="fallInStock">Fall in Stock </th>
            <th pSortableColumn="limitLevel">Limit Level </th>
            <th pSortableColumn="hldDay">Hld Day </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-product>
          <tr>
            <td>{{product.fallInStock }}</td>
            <td>{{product.limitLevel }} </td>
            <td>{{product.hldDay }}</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>
<!-- showOutPutTable &&  -->
<div class="out-put main" *ngIf="outputList.length">
  <p-card styleClass="mt-3">
    <ng-template pTemplate="header">
      <div class="stock-header">
        <h2 class="px-3 pt-3">Output Table</h2>
        <i class="pi pi-download" style="font-size: 1.5rem;cursor: pointer;" (click)="downloadInExcl()"></i>
      </div>
    </ng-template>
    <p-table [value]="outputList" [paginator]="outputList.length > 5" [rows]="5"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
      [rowsPerPageOptions]="[5,10, 25, 50]">
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="nameOfStock"> Name <p-sortIcon field="nameOfStock"></p-sortIcon></th>
          <th pSortableColumn="fallInStock">Fall in Stock <p-sortIcon field="fallInStock"></p-sortIcon></th>
          <th pSortableColumn="limitLevel">LimitLevel <p-sortIcon field="limitLevel"></p-sortIcon></th>
          <th pSortableColumn="hldDay">HoldingDay <p-sortIcon field="hldDay"></p-sortIcon></th>
          <th pSortableColumn="totalDays">#OfDays <p-sortIcon field="totalDays"></p-sortIcon></th>
          <th pSortableColumn="totalRetSum">TotalSum <p-sortIcon field="totalRetSum"></p-sortIcon></th>
          <th pSortableColumn="avgGain">AvgGain <p-sortIcon field="avgGain"></p-sortIcon></th>
          <th pSortableColumn="winPercent">Win% <p-sortIcon field="winPercent"></p-sortIcon></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-product>
        <tr>
          <td>{{product.nameOfStock}}</td>
          <td>{{product.fallInStock }}</td>
          <td>{{product.limitLevel}}</td>
          <td>{{product.hldDay}}</td>
          <td>{{product.totalDays}}</td>
          <td>{{product.totalRetSum}}</td>
          <td>{{product.avgGain}}</td>
          <td>{{product.winPercent}}</td>
        </tr>
      </ng-template>

    </p-table>
    <div class="flex justify-content-between mb-2">
      <div><i class="pi pi-angle-left cursor-pointer" style="font-size: 2rem" tooltipPosition="top" pTooltip="Prev"
          (click)="prevPage()"></i></div>
      <div><i class="pi pi-angle-right cursor-pointer" style="font-size: 2rem" pTooltip="Next" tooltipPosition="top"
          (click)="nextPage()"></i></div>
    </div>
  </p-card>
</div>
<div class="out-put main" style="max-width: 60%;" *ngIf="outputData.length">
  <p-card styleClass="mt-3">
    <ng-template pTemplate="header">
      <div class="stock-header">
        <h2 class="px-3 pt-3">Output Table</h2>
        <!-- <i class="pi pi-download" style="font-size: 1.5rem;cursor: pointer;" (click)="downloadInExcl()"></i> -->
      </div>
    </ng-template>
    <p-table [value]="outputData" [paginator]="outputData.length > 5" [rows]="5"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
      [rowsPerPageOptions]="[5,10, 25, 50]">
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name"> Name </th>
          <th pSortableColumn="index">Download </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-product>
        <tr>
          <td>{{product.name}}</td>
          <td><i class="pi pi-download" style="font-size: 1.5rem;cursor: pointer"
              (click)="stockExceldownload(product.index)"></i></td>
        </tr>
      </ng-template>
    </p-table>
    <!-- <div class="flex justify-content-between mb-2">
      <div><i class="pi pi-angle-left cursor-pointer" style="font-size: 2rem" tooltipPosition="top" pTooltip="Prev"
          (click)="prevPage()"></i></div>
      <div><i class="pi pi-angle-right cursor-pointer" style="font-size: 2rem" pTooltip="Next" tooltipPosition="top"
          (click)="nextPage()"></i></div>
    </div> -->
  </p-card>
</div>
<div class="flex justify-content-center my-5">
  <video controls="false" autoplay loop muted style="width: 70%;">
    <source src="/assets/videos/stock video.mp4" type="video/mp4">
  </video>

</div>
<!-- <ng-container *ngIf="showSpinner">
  <p-progressSpinner class="overlay" strokeWidth="1"></p-progressSpinner>
</ng-container> -->